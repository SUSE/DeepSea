{% if salt.saltutil.runner('select.minions', cluster='ceph', roles='mds') != [] %}
EXPORT
{
	Export_ID=1;

	Path = /;

	Pseudo = /cephfs/;

	Access_Type = RW;

	NFS_Protocols = 4;

	Transport_Protocols = TCP;

	FSAL {
		Name = CEPH;
	}
}

{% endif %}

{# Won't work for custom names... likely need a runner #}
{% if salt.saltutil.runner('select.minions', cluster='ceph', roles='rgw') != [] %}

{% for user in [ 'demo' ] %}
EXPORT
{
	Export_ID={{ loop.index + 1 }};

	Path = "/";

	Pseudo = "/{{ user }}";

	Access_Type = RW;

	NFS_Protocols = 4;

	Transport_Protocols = TCP;

	FSAL {
		Name = RGW;
		User_Id = "{{ user }}";
		Access_Key_Id ="{{ salt['rgwuser.access_key'](user) }}";
		Secret_Access_Key = "{{ salt['rgwuser.secret_key'](user) }}";
	}
}

RGW {
    ceph_conf = "/etc/ceph/ceph.conf";
}
{% endfor %}

{% endif %}
