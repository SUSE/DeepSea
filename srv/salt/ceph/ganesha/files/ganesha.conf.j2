{% if salt.saltutil.runner('select.minions', cluster='ceph', roles='mds') != [] %}
EXPORT
{
	Export_ID=1;

	Path = /;

	Pseudo = /cephfs/;

	Access_Type = RW;

	NFS_Protocols = 4;

	Transport_Protocols = TCP;

    FSAL {
            Name = CEPH;
            User_Id = "{{user_id}}";
            Secret_Access_Key = "{{secret_access_key}}";
    }
    {% endfor %}
    {% endfor %}

}

{% endif %}

{% if salt.saltutil.runner('select.minions', cluster='ceph', roles=role) != [] %}

{% for user in salt['rgw.users'](role) %}
EXPORT
{
	Export_ID={{ loop.index + 1 }};

	Path = "/";

	Pseudo = "/{{ user }}";

	Access_Type = RW;

	NFS_Protocols = 4;

	Transport_Protocols = TCP;

	FSAL {
		Name = RGW;
		User_Id = "{{ user }}";
		Access_Key_Id ="{{ salt['rgw.access_key'](user) }}";
		Secret_Access_Key = "{{ salt['rgw.secret_key'](user) }}";
	}
}

{% endfor %}

RGW {
    ceph_conf = "/etc/ceph/ceph.conf";
}

{% endif %}
