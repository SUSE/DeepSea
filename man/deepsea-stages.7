.TH deepsea 7
.SH NAME
deepsea stages \- orchestrations for a Ceph cluster life cycle
.SH DESCRIPTION
.B DeepSea Stages
are named Salt orchestrations.  Six stages, 0 through 5, represent the life cycle of a Ceph cluster.  Each stage is also named which may be used interchangeably with the number.
.RS 4
.PP
.PD 0
Stage 0 - Prep
.PP
Stage 1 - Discovery
.PP
Stage 2 - Configure
.PP
Stage 3 - Deploy
.PP
Stage 4 - Services
.PP
Stage 5 - Removal
.RE
.PD
.SH STAGES
.PP
The purpose of the stages is to segregate the many operations in deploying and maintaing a Ceph cluster into a logical abstraction.
.SS Stage 0 - Prep
.PP
This stage prepares the Salt environment and OS to provide any missing prerequisites for a successful deployment.  Examples include configuring a time service, synchronizing Salt modules, updating the kernel, installing packages and applying updates.
.SS Stage 1 - Discovery
This stage collects data from the minions in an effort to save the administrator the challenge of configuring Salt manually.  Minions can normally serve any role, but the storage role is constrained to those minions with available hardware.
.SS Stage 2 - Configure
The administrator creates a
.B policy.cfg
file that incorporates their role assignments to the various minions.  This stage processes this file and the fragments generated by the previous stage to configure the Salt pillar which is a key-value store.  This configuration drives the remaining Stages.
.SS Stage 3 - Deploy
This stage creates or adds to a basic Ceph cluster.  The basic Ceph cluster contains only
.B monitors
and
.B OSDs.
A Ceph monitor acts as a directory service providing maps to clients.  The OSD, Object Storage Daemon, manages a device such as an hard disk drive or solid state device.
.SS Stage 4 - Services
Ceph provides many services for existing clients.  This stage installs and configures these services which are iSCSI, CephFS, RadosGW and Ganesha.  The iSCSI gateways provide block level access to RBD images.  The CephFS service provides a POSIX filesystem.  The RadosGW presents an S3 and Swift access to objects.  Lastly, Ganesha provides NFS access to legacy clients for either CephFS or RadosGW.
.SS Stage 5 - Removal
This stage is necessary for the migration and removal of roles.  When the administrator unassigns or reassigns roles during Stage 2, this stage surgically removes configurations and shuts down services.
.SH EXAMPLE
Each orchestration command is nearly identical.  The stages have a descriptive and numerical name.  Either can be used.
.PP
# salt-run state.orch ceph.stage.0
.RE
# salt-run state.orch ceph.stage.prep
.PP
# salt-run state.orch ceph.stage.1
.RE
# salt-run state.orch ceph.stage.discovery
.PP
# salt-run state.orch ceph.stage.2
.RE
# salt-run state.orch ceph.stage.configure
.PP
# salt-run state.orch ceph.stage.3
.RE
# salt-run state.orch ceph.stage.deploy
.PP
# salt-run state.orch ceph.stage.4
.RE
# salt-run state.orch ceph.stage.services
.PP
# salt-run state.orch ceph.stage.5
.RE
# salt-run state.orch ceph.stage.removal
.PP
Additionally one orchestration will run Stages 1-5.  Stage 0 is excluded since provisioning systems will likely call or duplicate this stage.
.PP
# salt-run state.orch ceph.stage.all
.PP
All of these commands can also be prefixed with
.B deepsea
to give feedback during the process from the Salt event bus.  Salt orchestrations are unnervingly silent during execution and only report when complete.  For example,
.PP
# deepsea salt-run state.orch ceph.stage.0
.SH AUTHOR
Eric Jackson <ejackson@suse.com>
.SH SEE ALSO
.BR deepsea (1),
.BR deepsea (7),
.BR deepsea-commands (7)
